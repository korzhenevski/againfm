server {
    server_name again.fm www.again.fm;
    root /var/www/againfm/current/launch;
}

server {
	server_name <%= node['againfm']['host'] %>;

    # output compression saves bandwidth
    gzip on;
    gzip_http_version 1.1;
    gzip_vary on;
    gzip_comp_level 6;
    gzip_proxied any;
    gzip_types text/plain text/html text/css application/json application/x-javascript text/javascript;

    # Disable gzip for certain browsers.
    gzip_disable “MSIE [1-6].(?!.*SV1)”;

	location / {
        include uwsgi_params;
	    uwsgi_pass 127.0.0.1:3031;
	}

	# поисковые запросы идут на отдельного демона
	location /api/playlist/search {
		rewrite /api/playlist/search/([^/]+) /search/$1 break;
		proxy_pass http://127.0.0.1:6100;
	}

	location /static {
		expires 7d;
		add_header Cache-Control public;
		alias /var/www/againfm/current/afm/static;
	}

	location /admin/static {
		expires 7d;
		add_header Cache-Control public;
		alias /var/www/againfm/current/afm/admin/static;
	}

	location /mu-fa76d39d-fa0a0082-d8815605-c151db4b {
	    return 200 '42';
	}
}
