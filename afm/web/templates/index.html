<!DOCTYPE html>
<html ng-app="afm">
<head>
    <title>v2</title>
    <link href="/static/css/normalize.css" rel="stylesheet"/>
    <link href="/static/css/common.css" rel="stylesheet"/>
    <link href="/static/css/style.css" rel="stylesheet"/>
    <!--link href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css" rel="stylesheet"/-->
    <meta name="fragment" content="!" />
</head>
<body class="ng-cloak">
    <!--div class="modal-box ng-cloak" ng-show="template" ng-include="template"></div-->
    <div class="modal-box ng-cloak" ng-view></div>

    <script type="text/ng-template" id="/login.html">
        <modal id="login" title="Вход с паролем">
            <form name="loginForm" ng-submit="auth()">
                <input class="field" name="login" ng-model="form.login" type="email" placeholder="Электронная почта" required="" autofocus="" />
                <input class="field" name="password" ng-model="form.password" type="password" placeholder="Пароль" required />
                <div class="controls">
                    <input type="submit" class="button" value="Войти в профиль" ng-disabled="loginForm.$invalid" />
                    <a href="/amnesia" class="amnesia">восстановить пароль</a>
                </div>
                <hr class="line" />
            </form>
        </modal>
    </script>

    <script type="text/ng-template" id="/signup.html">
        <modal id="signup" title="Регистрация">
            <form name="signupForm" ng-submit="signup()">
                <input class="field" name="email" ng-model="form.email" type="email" placeholder="Электронная почта" required="" autofocus="" />
                <input class="field" name="password" ng-model="form.password" type="password" placeholder="Пароль" required="" />
                <input type="submit" class="button" value="Создать аккаунт" ng-disabled="signupForm.$invalid" />
            </form>
        </modal>
    </script>

    <script type="text/ng-template" id="/amnesia.html">
        <modal id="amnesia" title="Сброс пароля">
            <form name="amnesiaForm" ng-hide="result" ng-submit="amnesia()">
                <input class="field" name="email" ng-model="form.email" required type="email" placeholder="Электронная почта" />
                <input type="submit" class="button" value="Выслать на почту" />
            </form>
            <p ng-show="result">
                Пароль сброшен.
                <a href="{{ result.email_provider }}" ng-show="result.email_provider" target="_blank">Проверьте почту</a>
                <span ng-hide="result.email_provider">Проверьте почту</span>
            </p>
        </modal>
    </script>

    <div class="topline" ng-init="showTracks=false">
        <!-- TODO: нахера два центройда? -->
        <div class="topline-inner centroid">
            <table class="topmenu centroid">
                <tr>
                    <td width="20%">
                        <a ng-click="showTracks=!showTracks" class="tracks-toggle">
                            <i class="tracks-icon"></i>
                            Любимые треки и эфиры
                        </a>
                    </td>
                    <td>
                        <!--a href="">Добавить радио</a-->
                    </td>
                    <td align="right">
                        <p ng-hide="currentUser.isLogged()">
                            <a href="/login">вход с паролем</a> или <a href="/signup">завести аккаунт</a>
                        </p>
                        <p ng-hide="!currentUser.isLogged()">
                            <a ng-click="logout()">выйти</a>
                        </p>
                    </td>
                </tr>
            </table>

            <div ng-controller="TracksCtrl" ng-hide="!showTracks" class="tracks-box">
                <span class="tracks-corner"></span>
                <!-- TODO: выровнять высоту зоны прокрутки, не обрезать строчки треков. -->
                <div class="tracks-inner">
                    <div class="search" ng-hide="!tracks.length">
                        <input type="text" class="input-text search-field" ng-model="searchQuery" placeholder="поиск треков" />
                    </div>
                    <table class="tracks">
                        <tr ng-class="{'track-removed': track.removed, track: !track.removed}" ng-repeat="track in getTracks()">
                            <td class="title">{{ track.title }}</td>
                            <td class="controls" align="right">
                                <button ng-click="remove(track)" class="remove" ng-hide="track.removed"></button>
                                <a ng-click="restore(track)" ng-hide="!track.removed">отмена</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <table class="roof">
        <tr>
            <td>
                <!--img src="/static/i/logo.png" class="logo" /-->
            </td>
            <td>

            </td>
            <td align="right">
                <!--p>Сейчас на линии всего 10 493 человека. <a href="#">Рассказать в социалочки!</a></p-->
                <p>Двести тысяч пользователей слушают радио. А мы играем ;)</p>
            </td>
        </tr>
    </table>

    <div class="radio">
        <player src="/static/swf/player.swf"></player>

        <table class="top">
            <tr>
                <td class="top-left"></td>
                <td class="top-line"></td>
                <td class="top-right"></td>
            </tr>
        </table>
        <div class="ground">
        <div class="ground-shadow">
            <div class="content">
                <table class="radio-box" ng-controller="RadioCtrl">
                    <tr valign="top">
                        <td ng-controller="DisplayCtrl">
                            <div class="display-ground">
                            <div class="display-inner">
                                <div class="display">
                                    <h1 class="station-title">{{ currentStation.title }}</h1>
                                    <button ng-click="faveStation()" ng-hide="isStationFaved()">fave</button>
                                    <!--div class="track">
                                        <button class="like"></button>
                                        <h2>Very Long Artist - Very Long TrackName</h2>
                                    </div-->
                                </div>
                            </div>
                            </div>
                        </td>
                        <td rowspan="3">
                            <div class="radio-table">
                            <div class="table-inner" ng-controller="PlaylistCtrl">
                                <input type="search" class="search" placeholder="Поиск по названию радио" ng-model="searchQuery" />

                                <ul class="filters justified">
                                    <li ng-repeat="filter in filters">
                                        <span class="block" ng-class="itemClass(filter, currentFilter)" ng-click="selectFilter(filter)">{{ filter.title }}</span>
                                    </li>
                                </ul>

                                <div class="table-wrapper">
                                    <hr class="radio-line" />
                                    <div id="radio-cursor" class="radio-cursor" ng-hide="getPlaylist().indexOf(currentStation) == -1"></div>
                                    <ul class="playlist justified">
                                        <li ng-repeat="station in playlist|filter:searchQuery">
                                            <span class="block station-link" ng-class="itemClass(station, currentStation)" ng-click="selectStation(station)">{{ station.title }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td align="center">
                            <table class="controls" width="80%">
                            <tr align="center">
                                <td>
                                    <button class="record" disabled="disabled"></button>
                                </td>
                                <td>
                                    <button class="back" ng-disabled="!previousStation" ng-click="selectStation(previousStation)"></button>
                                </td>
                                <td>
                                    <button class="pause" ng-hide="!isPlaying()" ng-click="stop()"></button>
                                    <button class="play" ng-hide="isPlaying()" ng-click="play()"></button>
                                </td>
                                <td>
                                    <button class="random" ng-click="selectRandomStation()"></button>
                                </td>
                                <td>
                                    <button class="volume"></button>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="5">
                                    <input class="volume-slider" type="range" min="0" max="1" step="0.1" ng-change="saveVolume()" ng-model="volume" />
                                </td>
                            </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td height="281px"><div class="favorites" ng-controller="FavoritesCtrl">
                            <div class="favorites-inner">
                                <ul class="favorites-list justified">
                                    <li ng-repeat="station in getFavorites()">
                                        <div class="block" ng-click="selectStation(station)">
                                            {{ station.title }} <i class="remove" ng-click="remove(station.id)"></i>
                                        </div>
                                    </li>
                                </ul>
                                <img src="/static/i/my_favorites.png" class="signage" />
                            </div>
                        </div></td>
                    </tr>
                </table>
            </div>
        </div>
        </div>
        <div class="bottom">
        <table class="inner">
            <tr>
                <td class="bottom-left"></td>
                <td class="bottom-line"></td>
                <td class="bottom-right"></td>
            </tr>
        </table>
        </div>
    </div>

    <div class="footer centroid">
        <div class="container">
        <p>Made in China (更壞)</p>
        </div>
    </div>

    <!--script src="/static/js/script.js"></script-->
    <!--script src="/static/js/jquery-1.9.0.js"></script>
    <script src="/static/js/jquery-ui-1.10.0.custom.js"></script-->
    <script src="/static/js/angular.js"></script>
    <script src="/static/js/angular-resource.js"></script>
    <script src="/static/js/angular-cookies.js"></script>
    <script src="/static/js/swfobject.js"></script>
    <!--script src="/static/js/modernizr.js"></script-->
    <script src="/static/js/app/radio.js"></script>

    <script>
        afm.value('bootstrapUser', {{{ user|json|safe }}});
    </script>
</body>
</html>