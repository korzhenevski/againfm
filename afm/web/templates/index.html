<!DOCTYPE html>
<html ng-app="afm">
<head>
    <title>Радиоплеер Эгейн</title>
    <meta charset="utf-8"/>
    <meta name="description" content="Играет радио и сохраняет историю эфира. Хранит любимые треки в личном избранном." />
    <meta name="og:title" content="Эгейн" />
    <meta name="og:description" content="Тёплый ламповый радиоплеер" />
    <meta name="og:url" content="http://again.fm/" />
    <meta name="fragment" content="!" />
    <!--meta name="og:image" content="http://again.fm/static/i/social-logo.png" /-->
    <style>
        /* force hide angular markup while js not ready */
        .ng-cloak { display: none; }
    </style>
    {{% assets "styles" %}}
    <link href="{{{ ASSET_URL }}}" rel="stylesheet"/>
    {{% endassets %}}
    <script type="text/javascript">
        (function(a,c){a.__qbaka_eh=a.onerror;a.__qbaka_reports=[];a.onerror=function(){a.__qbaka_reports.push(arguments);if(a.__qbaka_eh)try{a.__qbaka_eh.apply(a,arguments)}catch(b){}};a.onerror.qbaka=1;a.qbaka={report:function(){},customParams:{},set:function(a,b){qbaka.customParams[a]=b},exec:function(a){try{a()}catch(b){qbaka.reportException(b)}},reportException:function(){}};var b=c.createElement("script"),e=c.getElementsByTagName("script")[0],d=function(){e.parentNode.insertBefore(b,e)};b.id="qbaka";b.type="text/javascript";b.async=!0;b.src="//cdn.qbaka.net/reporting.js";"[object Opera]"==a.opera?c.addEventListener("DOMContentLoaded",d):d();qbaka.key="73b99461c5bf44245c159c11d57146b3"})(window,document);qbaka.options={autoStacktrace:1,trackEvents:1};
    </script>
</head>
<body class="ng-cloak" ng-init="showTrack=false">
    <div class="modal-box ng-cloak" ng-view></div>

    <script type="text/ng-template" id="/login.html">
        <modal id="login" title="Вход с паролем">
            <form name="loginForm" ng-submit="auth()">
                <input class="text" name="login" ng-model="form.login" type="email" placeholder="Электронная почта" required="" autofocus="" />
                <input class="text" name="password" ng-model="form.password" type="password" placeholder="Пароль" required />
                <div class="controls">
                    <input type="submit" class="btn" value="Войти в профиль" ng-disabled="loginForm.$invalid" />
                    <a href="/amnesia" class="amnesia">восстановить пароль</a>
                </div>
                <p class="error" ng-switch on="error.code" ng-show="error">
                    <span ng-switch-when="404">Нет такого пользователя</span>
                    <span ng-switch-when="401">Неправильно введен логин или пароль</span>
                    <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
                </p>
                <!--hr class="line" /-->
            </form>
        </modal>
    </script>

    <script type="text/ng-template" id="/signup.html">
        <modal id="signup" title="Регистрация">
            <form name="signupForm" ng-submit="signup()">
                <input class="text" name="email" ng-model="form.email" type="email" placeholder="Электронная почта" required="" autofocus="" />
                <input class="text" name="password" ng-model="form.password" type="password" placeholder="Пароль" required="" />
                <input type="submit" class="btn" value="Создать аккаунт" ng-disabled="signupForm.$invalid" />
            </form>
            <p class="error" ng-switch on="error.code" ng-show="error">
                <span ng-switch-when="409">Такой пользователь уже зарегистрирован</span>
                <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
            </p>
        </modal>
    </script>

    <script type="text/ng-template" id="/amnesia.html">
        <modal id="amnesia" title="Сброс пароля">
            <form name="amnesiaForm" ng-hide="result" ng-submit="amnesia()">
                <input class="text" name="email" ng-model="form.email" required type="email" placeholder="Электронная почта" />
                <input type="submit" class="btn" value="Выслать на почту" ng-disabled="amnesiaForm.$invalid" />
            </form>
            <p class="error" ng-switch on="error.code" ng-show="error">
                <span ng-switch-when="404">Пользователь не найден</span>
                <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
            </p>
            <p ng-show="result">
                Пароль сброшен.
                <a href="{{ result.email_provider }}" ng-show="result.email_provider" target="_blank">Проверьте почту</a>
                <span ng-hide="result.email_provider">Проверьте почту</span>
            </p>
        </modal>
    </script>

    <div class="topline">
        <!-- TODO: нахера два центройда? -->
        <div class="topline-inner centroid">
            <table class="topmenu centroid" ng-controller="MenuCtrl">
                <tr>
                    <td width="20%">
                        <a ng-click="toggleTracks($event)" class="tracks-toggle">
                            <i class="tracks-icon"></i>
                            Любимые треки
                        </a>
                    </td>
                    <td></td>
                    <td align="right">
                        <p ng-hide="currentUser.isLogged()">
                            <a href="/login">войти с паролем</a> или <a href="/signup">завести аккаунт</a>
                        </p>
                        <p ng-show="currentUser.isLogged()">
                            <a ng-click="logout()">выйти</a>
                        </p>
                    </td>
                </tr>
            </table>

            <div ng-controller="TracksCtrl" class="tracks-box" ng-class="{visible: visible}">
                <span class="tracks-corner"></span>
                <div class="tracks-inner">
                    <div class="search" ng-show="haveTracks()">
                        <input type="text" class="text search-field" ng-model="searchQuery" placeholder="поиск треков" />
                    </div>
                    <div class="help" ng-hide="haveTracks()">
                        <p>Сюда можно отложить название трека из&nbsp;<nobr>радио-эфира</nobr>.</p>
                    </div>
                    <table class="tracks">
                        <tr ng-class="trackClass(track)" ng-repeat="track in getTracks()">
                            <td class="title">{{ track.title }}</td>
                            <td class="controls" align="right">
                                <i ng-click="remove(track)" class="remove" ng-hide="track.removed"></i>
                                <!-- TODO: fix hover bug -->
                                <a ng-click="restore(track)" class="restore" ng-show="track.removed">отмена</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <table class="roof">
        <tr>
            <td class="logo">
                <a href="/" target="_self"><img src="/static/i/logo.png" width="198" height="46" alt="Радиоплеер Эгейн.ФМ" /></a>
            </td>
            <td>

            </td>
            <td align="right">
                <p>Сейчас на линии всего 10 493 человека. <a href="#">Рассказать в социалочки!</a></p>
            </td>
        </tr>
    </table>

    <div class="radio">
        <table class="top">
            <tr>
                <td class="top-left"></td>
                <td class="top-line"></td>
                <td class="top-right"></td>
            </tr>
        </table>
        <div class="ground">
        <div class="ground-shadow">
            <div class="content">
                <table class="radio-box" ng-controller="RadioCtrl">
                    <tr valign="top">
                        <td ng-controller="DisplayCtrl" width="312px">
                            <div class="display-ground">
                            <div class="display-inner">
                                <div class="display">
                                    <h1 class="clock" clock="currentStation()"></h1>
                                    <div class="station" ng-show="currentStation()">
                                        <h1 class="station-title ellipsis" title="{{ currentStation().title }}">{{ currentStation().title }}</h1>
                                        <button class="fave" ng-class="{selected: isStationFaved()}" ng-click="faveStation()"></button>
                                    </div>
                                    <!--div class="controls">
                                        <button class="button">История эфира</button>
                                        <button class="button">О станции</button>
                                        <button class="button">Ссылка</button>
                                    </div-->

                                    <div class="track" ng-show="hasTrack()">
                                        <button class="like" ng-class="{selected: isTrackFaved()}" ng-click="faveTrack()"></button>
                                        <h2 class="track-title ellipsis" title="{{ track.title }}">
                                            <span ng-show="track.artist"><strong>{{ track.artist }}</strong> &mdash; {{ track.name }}</span>
                                            <span ng-hide="track.artist">{{ track.title }}</span>
                                        </h2>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </td>
                        <td rowspan="3">
                            <div class="radio-table">
                            <div class="table-inner" ng-controller="PlaylistCtrl">
                                <div class="search">
                                    <input type="search" class="search-field" placeholder="Поиск по названию радио" ng-model="searchQuery" />
                                </div>

                                <ul class="filters justified">
                                    <li ng-repeat="filter in filters">
                                        <span class="block" ng-class="itemClass(filter, currentFilter)" ng-click="selectFilter(filter)">{{ filter.title }}</span>
                                    </li>
                                </ul>

                                <div class="table-wrapper">
                                    <hr class="radio-line" />
                                    <div id="radio-cursor" class="radio-cursor" ng-show="showCursor()"></div>
                                    <ul class="playlist justified">
                                        <li ng-repeat="station in playlist|filter:searchQuery">
                                            <span class="block station-link" ng-class="itemClass(station, currentStation())" ng-click="selectStation(station)">{{ station.title }}</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td align="center">
                            <table class="controls" width="80%">
                            <tr align="center">
                                <td>
                                    <button class="record" disabled="disabled"></button>
                                </td>
                                <td>
                                    <button class="back" ng-disabled="!previousStation()" ng-click="selectStation(previousStation())"></button>
                                </td>
                                <td>
                                    <button class="pause" ng-show="player.playing" ng-click="player.stop()"></button>
                                    <button class="play" ng-hide="player.playing" ng-disabled="!currentStation()" ng-click="player.play()"></button>
                                </td>
                                <td>
                                    <button class="random" ng-click="selectRandomStation()"></button>
                                </td>
                                <td>
                                    <div class="volume-wrapper" ng-class="{muted: isMuted()}">
                                        <button class="volume" ng-click="toggleMute()"></button>
                                        <div class="volume-slider">
                                            <div class="line">
                                                <div class="handle" volume="volume" on-change="saveVolume()" volume-handle></div>
                                            </div>
                                            <div class="volume-icon" ng-click="toggleMute()"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td height="281px"><div class="favorites" ng-controller="FavoritesCtrl">
                            <div class="favorites-inner">
                                <ul class="favorites-list justified">
                                    <li ng-repeat="station in getFavorites()">
                                        <div class="block" ng-click="selectStation(station)">
                                            {{ station.title }} <i class="remove" ng-click="remove(station.id)"></i>
                                        </div>
                                    </li>
                                </ul>
                                <div class="signage"></div>
                            </div>
                        </div></td>
                    </tr>
                </table>
            </div>
        </div>
        </div>
        <div class="bottom">
        <table class="inner">
            <tr>
                <td class="bottom-left"></td>
                <td class="bottom-line"></td>
                <td class="bottom-right"></td>
            </tr>
        </table>
        </div>
    </div>

    <div class="footer centroid">
        <div class="container">
            <table width="100%">
                <tr>
                    <td>
                        <p class="credits"><span><i></i>Сделано в России</span></p>
                    </td>
                    <td align="right">
                        <a href="https://twitter.com/share" class="twitter-share-button"
                           data-url="http://again.fm/" data-via="againfm" data-lang="en"
                           data-text="Радиоплеер Эгейн.ФМ"></a>
                        <div id="vk-like"></div>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <script>
        /* script.js */
        (function(j,g,b){"undefined"!=typeof b.module&&b.module.exports?b.module.exports=g():"undefined"!=typeof b.define&&"function"==b.define&&b.define.amd?define(j,g):b[j]=g()})("$script",function(){function j(b,a){for(var c=0,f=b.length;c<f;++c)if(!a(b[c]))return k;return 1}function g(b,a){j(b,function(c){return!a(c)})}function b(h,a,c){function f(a){return a.call?a():m[a]}function d(){if(!--k){m[e]=1;s&&s();for(var a in l)j(a.split("|"),f)&&!g(l[a],f)&&(l[a]=[])}}h=h[n]?h:[h];var p=a&&a.call,s=p?a:c,
                e=p?h.join(""):a,k=h.length;setTimeout(function(){g(h,function(a){if(q[a])return 2==q[a]&&d();q[a]=1;t(!w.test(a)&&r?r+a+".js":a,d)})},0);return b}function t(b,a){var c=d.createElement("script"),f=k;c.onload=c.onerror=c[u]=function(){c[e]&&!/^c|loade/.test(c[e])||f||(c.onload=c[u]=null,f=1,q[b]=2,a())};c.async=1;c.src=b;v.insertBefore(c,v.firstChild)}var d=document,v=d.getElementsByTagName("head")[0],w=/^https?:\/\//,m={},l={},r,q={},k=!1,n="push",e="readyState",u="onreadystatechange";!d[e]&&d.addEventListener&&
        (d.addEventListener("DOMContentLoaded",function a(){d.removeEventListener("DOMContentLoaded",a,k);d[e]="complete"},k),d[e]="loading");b.get=t;b.order=function(a,c,f){(function p(d){d=a.shift();a.length?b(d,p):b(d,c,f)})()};b.path=function(a){r=a};b.ready=function(a,c,d){a=a[n]?a:[a];var e=[];!g(a,function(a){m[a]||e[n](a)})&&j(a,function(a){return m[a]})?c():(a=a.join("|"),l[a]=l[a]||[],l[a][n](c),d&&d(e),!0);return b};return b},this);
    </script>

    {{% assets "scripts" %}}
    <script src="{{{ ASSET_URL }}}"></script>
    {{% endassets %}}

    {{% if not config.DEBUG %}}
        <script type="text/javascript">
            var _gaq = [
                ['_setAccount', 'UA-21858820-1'],
                ['_setDomainName', 'again.fm'],
                ['_setAllowLinker', true],
                ['_setSiteSpeedSampleRate', 100],
                ['_trackPageview']
            ];
            $script(('https:'==location.protocol?'//ssl':'http://www')+'.google-analytics.com/ga.js');
            $script("//platform.twitter.com/widgets.js");
            $script("//vk.com/js/api/openapi.js?79", function(){
                VK.init({apiId: 3183069, onlyWidgets: true});
                VK.Widgets.Like('vk-like', {type: 'mini'});
            });
        </script>

        <script type="text/javascript">
            (function (d, w, c) {
                (w[c] = w[c] || []).push(function() {
                    try {
                        w.yaCounter18922339 = new Ya.Metrika({id:18922339,
                            webvisor:true,
                            clickmap:true,
                            trackLinks:true,
                            accurateTrackBounce:true,
                            trackHash:true});
                    } catch(e) { }
                });

                var n = d.getElementsByTagName("script")[0],
                        s = d.createElement("script"),
                        f = function () { n.parentNode.insertBefore(s, n); };
                s.type = "text/javascript";
                s.async = true;
                s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

                if (w.opera == "[object Opera]") {
                    d.addEventListener("DOMContentLoaded", f, false);
                } else { f(); }
            })(document, window, "yandex_metrika_callbacks");
        </script>
        <noscript><div><img src="//mc.yandex.ru/watch/18922339" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    {{% endif %}}

    <script>
        afm.value('bootstrapUser', {{{ user|json|safe }}});
        afm.constant('cometUrl', {{{ config.COMET_URL|json|safe }}});
    </script>
</body>
</html>