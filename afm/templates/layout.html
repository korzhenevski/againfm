<!DOCTYPE html>
<html xmlns:og="http://ogp.me/ns#">
<head>
    <title>{{% block title %}}Again.FM{{% endblock %}}</title>
    <meta charset="utf-8" />
    <meta name="description" content="{{% block description %}}Радиоплеер. Играет радио и сохраняет историю прямого эфира.{{% endblock %}}" />
    <meta name="og:url" content="http://again.fm/" />

    {# скрываем шаблоны до отработки ангулар парсера #}
    <style>.ng-cloak { display: none; }</style>

    {# базовые стили #}
    {{% assets "styles" %}}
    <link href="{{{ ASSET_URL }}}" rel="stylesheet"/>
    {{% endassets %}}

    {# подключаемые стили #}
    {{% block styles %}}{{% endblock %}}

    {# трекинг js-ошибок в qbaka.net #}
    {{% if not config.DEBUG %}}
        {{% include 'extras/qbaka.html' %}}
    {{% endif %}}
</head>
<body ng-init='bootstrapUser={{{ current_user.get_public()|json }}}; bootstrapGenres={{{ genres|json }}}'>
    {{% block top_content %}}{{% endblock %}}
    <table class="roof">
        <tr>
            <td class="logo">
                <a href="/" target="_self"><img src="/static/i/logo.png" width="198" height="46" alt="Радиоплеер Эгейн" /></a>
            </td>
            <td>
            </td>
        </tr>
    </table>

    {{% block content %}}{{% endblock %}}
    {# подвал #}
    <div class="footer centroid">
        <div class="container">
            <table width="100%">
                <tr>
                    <td>
                        <p>
                            <span class="copyright">&copy; 2011&mdash;{{{ year }}}</span>
                            <a href="/feedback">обратная связь</a>
                        </p>
                    </td>
                    <td align="right">
                        <a href="https://twitter.com/share" class="twitter-share-button"
                           data-url="http://again.fm/" data-via="againfm" data-lang="en"
                           data-text="Радиоплеер Эгейн"></a>
                        <div id="vk-like"></div>
                    </td>
                </tr>
            </table>
        </div>
    </div>

{# базовые скрипты #}
{{% assets 'scripts' %}}
<script src="{{{ ASSET_URL }}}"></script>
{{% endassets %}}

{# подключаемые скрипты #}
{{% block scripts %}}{{% endblock %}}

{{% include 'extras/scriptjs.html' %}}

{# счетчики: yandex, google analytics, ... #}
{{% if not config.DEBUG %}}
{{% include 'extras/counters.html' %}}
{{% endif %}}

<div class="flash-engine" id="flash-player-engine" data-src="/static/swf/player.swf"></div>

<script type="text/ng-template" id="/login.html">
    <modal id="login" title="Вход с паролем">
        <form name="loginForm" data-ng-submit="auth()">
            <input class="text" name="login" data-ng-model="form.login" autofocus="autofocus"
                   type="email" placeholder="Электронная почта" required="" autofocus="" />
            <input class="text" name="password" data-ng-model="form.password" type="password" placeholder="Пароль" required />
            <div class="controls">
                <input type="submit" class="btn" value="Войти" data-ng-disabled="loginForm.$invalid" />
                <a href="/amnesia" class="amnesia">забыли пароль?</a>
            </div>
            <p class="error" data-ng-switch data-on="error.code" data-ng-show="error">
                <span data-ng-switch-when="404">Нет такого пользователя</span>
                <span data-ng-switch-when="401">Неправильно введен логин или пароль</span>
                <span data-ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
            </p>
            <!--hr class="line" /-->
        </form>
    </modal>
</script>

<script type="text/ng-template" id="/signup.html">
    <modal id="signup" title="Регистрация">
        <form name="signupForm" data-ng-submit="signup()">
            <input class="text" name="email" data-ng-model="form.email" autofocus="autofocus"
                   type="email" placeholder="Электронная почта" required="" autofocus="" />
            <input class="text" name="password" data-ng-model="form.password" type="password" placeholder="Пароль" required="" />
            <input type="submit" class="btn" value="Зарегистрироваться" data-ng-disabled="signupForm.$invalid" />
        </form>
        <p class="error" data-ng-switch data-on="error.code" data-ng-show="error">
            <span data-ng-switch-when="409">Такой пользователь уже зарегистрирован</span>
            <span data-ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
        </p>
    </modal>
</script>

<script type="text/ng-template" id="/amnesia.html">
    <modal id="amnesia" title="Сброс пароля">
        <form name="amnesiaForm" data-ng-hide="result" data-ng-submit="amnesia()">
            <input class="text" name="email" data-ng-model="form.email" required=""
                   type="email" placeholder="Электронная почта" autofocus="autofocus" />
            <input type="submit" class="btn" value="Выслать на почту" data-ng-disabled="amnesiaForm.$invalid" />
        </form>
        <p class="error" data-ng-switch on="error.code" data-ng-show="error">
            <span data-ng-switch-when="404">Пользователь не найден</span>
            <span data-ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
        </p>
        <p data-ng-show="result">
            Пароль сброшен.
            <a href="{{ result.email_provider }}" data-ng-show="result.email_provider" target="_blank">Проверьте почту</a>
            <span data-ng-hide="result.email_provider">Проверьте почту</span>
        </p>
    </modal>
</script>

<script type="text/ng-template" id="/feedback.html">
    <modal id="feedback" title="Обратная связь">
        <form name="feedbackForm" data-ng-submit="feedback()" data-ng-hide="result">
            <input type="email" class="text" name="email" autofocus="autofocus"
                   data-ng-model="form.email" placeholder="Электронная почта" required="" autofocus="" />
            <textarea rows="4" class="text" name="text" data-ng-model="form.text" placeholder="Текст" required=""></textarea>
            <input type="submit" class="btn" value="Отправить сообщение" data-ng-disabled="feedbackForm.$invalid" />
            {# <p class="mail">
                Будет нечестно не сказать, что мы еще <br>читаем письма с
                <a href="mailto:feedback@again.fm?subject=Обратная+связь" target="_blank">feedback@again.fm</a>
            </p> #}
        </form>
        <p data-ng-show="result">Сообщение отправлено, спасибо :)</p>
        <p class="error" data-ng-switch on="error.code" data-ng-show="error">
            <span data-ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
        </p>
    </modal>
</script>

</body>
</html>