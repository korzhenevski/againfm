<!DOCTYPE html>
<html xmlns:og="http://ogp.me/ns#">
<head>
    <title>{{% block title %}}Эгейн.ФМ{{% endblock %}}</title>
    <meta charset="utf-8" />
    <meta name="description" content="{{% block description %}}Радиоплеер. Играет музыку, вещает новости, ведет историю эфира.{{% endblock %}}" />
    <meta name="og:url" content="http://again.fm/" />
    <meta http-equiv="X-Frame-Options" content="deny" />

    <style>.ng-cloak { display: none; }</style>
    <link href="/static/css/normalize.css" rel="stylesheet" />
    <link href="/static/css/style.css" rel="stylesheet" />

    {# подключаемые стили #}
    {{% block styles %}}{{% endblock %}}

    {# трекинг js-ошибок в qbaka.net #}
    {{% if not config.DEBUG %}}
        {{% include 'extras/qbaka.html' %}}
    {{% endif %}}
</head>

<body ng-controller="UserCtrl" ng-init='setUser({{{ current_user.get_public('id,email')|json }}})'>
    <div class="modal-back ng-cloak" ng-show="visible" modal-view></div>

    {{% block top_content %}}{{% endblock %}}

    <table class="roof">
        <tr>
            <td class="logo">
                <a href="/" target="_self"><img src="/static/i/logo.png" width="198" height="46" alt="Радиоплеер Эгейн" /></a>
            </td>
            <td>
            </td>
        </tr>
    </table>

    {{% block content %}}{{% endblock %}}
    {# подвал #}
    <div class="footer centroid">
        <div class="container">
            <table width="100%">
                <tr>
                    <td>
                        <p>
                            <span class="copyright">&copy; 2011&mdash;{{{ year }}}</span>
                            <a href="/feedback">обратная связь</a>
                        </p>
                    </td>
                    <td align="right">
                        <a href="https://twitter.com/share" class="twitter-share-button"
                           data-url="http://again.fm/" data-via="againfm" data-lang="en"
                           data-text="Радиоплеер Эгейн"></a>
                        <div id="vk-like"></div>
                    </td>
                </tr>
            </table>
        </div>
    </div>

{# базовые скрипты #}

{{% for name in ('angular', 'angular-cookies', 'angular-resource') %}}
    <script src="/static/js/common/{{{ name }}}.js"></script>
{{% endfor %}}

{# подключаемые скрипты #}
{{% block scripts %}}{{% endblock %}}

{{% include 'extras/scriptjs.html' %}}

{# счетчики: yandex, google analytics, ... #}
{{% if not config.DEBUG %}}
{{% include 'extras/counters.html' %}}
{{% endif %}}


<script type="text/ng-template" id="login.html">
    <div modal="login" title="Вход с паролем">
        <form name="form" ng-submit="submit()" ng-class="{errors: showErrors}" user-form>
            <input class="text" name="login" ng-model="data.login"
                   type="email" placeholder="Электронная почта" required autofocus />

            <input class="text" name="password" ng-model="data.password" type="password" placeholder="Пароль" required />

            <div class="controls">
                <input type="submit" class="btn" value="Войти" ng-disabled="form.$invalid && showErrors" />
                <a href="/amnesia" class="amnesia">забыли пароль?</a>
            </div>

            <p class="error" ng-switch data-on="error.code" ng-show="error">
                <span ng-switch-when="404">Нет такого пользователя</span>
                <span ng-switch-when="401">Неправильно введен логин или пароль</span>
                <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
            </p>
        </form>
    </div>
</script>

<script type="text/ng-template" id="signup.html">
    <div modal="signup" title="Регистрация">
        <form name="form" ng-submit="submit()" ng-class="{errors: showErrors}" user-form>
            <input class="text" name="email" ng-model="data.email"
                   type="email" placeholder="Электронная почта" required autofocus />
            <input class="text" name="password" ng-model="data.password" type="password" placeholder="Пароль" required />

            <input type="submit" class="btn" value="Зарегистрироваться" ng-disabled="form.$invalid && showErrors" />
        </form>

        <p class="error" ng-switch data-on="error.code" ng-show="error">
            <span ng-switch-when="409">Такой пользователь уже зарегистрирован</span>
            <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
        </p>
    </div>
</script>

<script type="text/ng-template" id="amnesia.html">
    <div modal="amnesia" title="Сброс пароля">
        <form name="form" ng-submit="submit()" ng-class="{errors: showErrors}" ng-hide="result" user-form>
            <input class="text" name="email" ng-model="data.email"
                   type="email" placeholder="Электронная почта" autofocus required />

            <input type="submit" class="btn" value="Выслать на почту" ng-disabled="form.$invalid && showErrors" />
        </form>

        <p class="error" ng-switch on="error.code" ng-show="error">
            <span ng-switch-when="404">Пользователь не найден</span>
            <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
        </p>

        <p ng-show="result">
            Пароль сброшен.
            <a href="{{ result.email_provider }}" ng-show="result.email_provider" target="_blank">Проверьте почту</a>
            <span ng-hide="result.email_provider">Проверьте почту</span>
        </p>
    </div>
</script>

<script type="text/ng-template" id="feedback.html">
    <div modal="feedback" title="Обратная связь">
        <form name="form" ng-submit="submit()" ng-class="{errors: showErrors}" ng-hide="result" user-form>
            <textarea rows="6" class="text" name="text" ng-model="data.text"
                      placeholder="Текст" autofocus="" required=""></textarea>

            <input ng-hide="user.isLogged()" type="email" class="text" name="email"
                   ng-model="data.email" placeholder="Электронная почта" required />

            <input type="submit" class="btn" value="Отправить" ng-disabled="form.$invalid && showErrors" />
        </form>
        <p ng-show="result">Сообщение отправлено, спасибо :)</p>
        <p class="error" ng-switch on="error.code" ng-show="error">
            <span ng-switch-default>Ошибка при обработке запроса. Попробуйте позже.</span>
        </p>
    </div>
</script>

    <div class="flash-engine" id="flash-player-engine" data-src="/static/swf/player.swf"></div>
</body>
</html>