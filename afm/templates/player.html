{{% extends "layout.html" %}}

{{% block top_content %}}
    <div class="modal-box ng-cloak" ng-view=""></div>
    {# шаблон индикатора загрузки на CSS3 #}
    <script type="text/ng-template" id="/loader.html">
        <div id="floatingBarsG">
            <div class="blockG" id="rotateG_01"></div>
            <div class="blockG" id="rotateG_02"></div>
            <div class="blockG" id="rotateG_03"></div>
            <div class="blockG" id="rotateG_04"></div>
            <div class="blockG" id="rotateG_05"></div>
            <div class="blockG" id="rotateG_06"></div>
            <div class="blockG" id="rotateG_07"></div>
            <div class="blockG" id="rotateG_08"></div>
        </div>
    </script>

    <div class="topline">
        {# TODO: нахера два центройда? #}
        <div class="topline-inner centroid">

            <div class="topmenu" ng-controller="MenuCtrl">
                <div class="menu-item">
                    <p>
                        <a ng-click="toggleTracks($event)" class="tracks-toggle">
                            <i class="tracks-icon"></i>Любимые песни из эфира
                        </a>
                    </p>
                </div>
                <div class="menu-item side-item">
                    <p ng-hide="user.isLogged()">
                        <a href="/signup">Стать постоянным слушателем</a>
                        <a href="/login">Войти с паролем</a>
                    </p>
                    <p ng-show="user.isLogged()">
                        <a ng-click="logout()">выйти</a>
                    </p>
                </div>
            </div>

            <div ng-controller="TracksCtrl" class="tracks-box" ng-class="{visible: visible}">
                <span class="tracks-corner"></span>
                <div class="tracks-inner">
                    <div class="search" ng-show="haveTracks()">
                        <input type="text" class="text search-field" ng-model="searchQuery" placeholder="поиск треков" />
                    </div>
                    <div class="help" ng-hide="haveTracks()">
                        <p>Сюда можно отложить название трека из&nbsp;<nobr>радио-эфира</nobr>.</p>
                    </div>
                    <table class="tracks">
                        <tr ng-class="trackClass(track)" ng-repeat="track in getTracks()">
                            {#
                            artist - track          (today, yesterday, ..., 21 марта, 21.08.09)
                            station | time
                            #}
                            <td class="title">{{ track.title }}</td>
                            <td class="controls" align="right">
                                <i ng-click="remove(track)" class="remove" ng-hide="track.removed"></i>
                                {# TODO: fix hover bug #}
                                <a ng-click="restore(track)" class="restore" ng-show="track.removed">отмена</a>
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
{{% endblock %}}

{{% block content %}}
<div class="radio">
    <table class="top">
        <tr>
            <td class="top-left"></td>
            <td class="top-line"></td>
            <td class="top-right"></td>
        </tr>
    </table>
    <div class="ground">
        <div class="ground-shadow">
            <div class="content">
                <table class="radio-box" ng-controller="PlayerCtrl">
                    <tr valign="top">
                        <!-- Минидисплей -->
                        <td width="312px">
                            <div class="display-ground">
                                <div class="display-inner">
                                    <div class="display" ng-controller="DisplayCtrl">
                                        <div ng-show="title">
                                            <p class="title" ng-class="{starred: starred()}" ng-click="star()">
                                                <span class="marquee">
                                                    {{ title }}
                                                </span>
                                                <span class="star"></span>
                                            </p>
                                            <p class="track" ng-class="{liked: track.favorite}"
                                               ng-click="like()" ng-show="track">
                                                <span class="marquee" ng-hide="track.artist">{{ track.title }}</span>
                                                <span class="marquee" ng-show="track.artist">
                                                    <strong>{{ track.artist }}</strong> &mdash; {{ track.name }}
                                                </span>
                                                <span class="like"></span>
                                            </p>
                                        </div>
                                        <div class="clock" clock="title"></div>
                                    </div>
                                </div>
                            </div>
                        </td>

                        <!-- Шкала -->
                        <td rowspan="3">
                            <div class="radio-table">
                                <div class="table-inner" ng-controller="PlaylistCtrl" ng-init="selectTab('featured')">
                                    <div class="group">
                                        <div class="search">
                                            <input type="search" placeholder="поиск радио" class="search-field" ng-model="searchQuery" />
                                        </div>
                                        <div class="loader"></div>
                                    </div>

                                    <!-- навигация -->
                                    <ul class="tabs justified">
                                        <li>
                                            <span class="block" ng-class="tabClass('featured')" ng-click="selectTab('featured')">Подборка</span>
                                        </li>
                                        <li ng-repeat="tab in tabs">
                                            <span class="block" ng-class="tabClass(tab.id)" ng-click="selectTab(tab.id)">{{ tab.title }}</span>
                                        </li>
                                    </ul>

                                    <!-- список радиостанций -->
                                    <div class="table-wrapper">
                                        <hr class="radio-line" />
                                        <ul class="playlist justified">
                                            <li ng-repeat="station in playlist">
                                                <div class="block station-link" ng-click="selectStation(station)">
                                                    <span class="link">{{ station.title }}</span>
                                                </div>
                                            </li>
                                            <li ng-hide="hasList()" class="ng-cloak not-found">
                                                <div class="block">
                                                    Ничего не найдено
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr>

                        <!-- Контролы управления -->
                        <td align="center">
                            <table class="controls" width="80%">
                                <tr align="center">
                                    <td>
                                        <!--button class="record"></button-->
                                    </td>
                                    <td>
                                        <!--button class="back" ng-disabled="!previousStation()" ng-click="selectStation(previousStation())"></button-->
                                    </td>
                                    <td>
                                        <button class="play" ng-click="play()" ng-hide="isPlaying()"></button>
                                        <button class="pause" ng-click="stop()" ng-show="isPlaying()"></button>
                                    </td>
                                    <td>
                                        <button class="random" ng-click="selectRandomStation()"></button>
                                    </td>
                                    <td>
                                        <div class="volume-wrapper" ng-class="{muted: isMuted()}">
                                            <button class="volume" ng-click="toggleMute()"></button>
                                            <div class="volume-slider hidden">
                                                <div class="line">
                                                    <div class="handle" volume="volume" on-change="saveVolume()" volume-handle></div>
                                                </div>
                                                <div class="volume-icon" ng-click="toggleMute()"></div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>

                    <tr>
                        <!-- Мое избранное -->
                        <td class="favorites-cell">
                            <div class="favorites" ng-controller="FavoritesCtrl">
                            <div class="favorites-inner">
                                <ul class="favorites-list justified">
                                    <li ng-repeat="station in getFavorites()">
                                        <div class="block" ng-click="selectStation(station)">
                                            {{ station.title }} <i class="remove" ng-click="remove(station.id)"></i>
                                        </div>
                                    </li>
                                </ul>
                                <div class="signage"></div>
                            </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div class="bottom">
        <table class="inner">
            <tr>
                <td class="bottom-left"></td>
                <td class="bottom-line"></td>
                <td class="bottom-right"></td>
            </tr>
        </table>
    </div>
</div>
{{% endblock %}}

{{% block styles %}}
    <link href="/static/css/loader.css" rel="stylesheet"/>
{{% endblock %}}

{{% block scripts %}}
    <script src="/static/js/common/swfobject.js"></script>
    <script src="/static/js/common/comet.js"></script>
    <script src="/static/js/afm.js"></script>
    <script src="/static/js/sound.js"></script>
    <script src="/static/js/player.js"></script>
    <script src="/static/js/common/ui-transition.js"></script>
    <script src="/static/js/common/ui-animate.js"></script>
    <script>
        angular.element(document).ready(function(){
            angular.bootstrap(document, ['afm.player']);
        });
    </script>
{{% endblock %}}
